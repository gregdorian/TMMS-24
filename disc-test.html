<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>Test DISC - Evaluación de Personalidad</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
      margin: 0;
      padding: 20px;
    }

    .container {
      max-width: 800px;
      margin: auto;
      background: #fff;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 10px #ccc;
    }

    h1 {
      color: #3498db;
      text-align: center;
    }

    h2 {
      color: #2c3e50;
      border-bottom: 1px solid #ccc;
      padding-bottom: 5px;
      margin-top: 30px;
    }

    .intro-box {
      border-left: 5px solid #3498db;
      background: #ecf6fd;
      padding: 15px;
      margin-bottom: 20px;
    }

    .question {
      margin-bottom: 20px;
      border: 2px solid transparent;
      padding: 10px;
      border-radius: 5px;
    }

    .question.invalid {
      border-color: #e74c3c;
      background-color: #fef0ef;
    }

    .options {
      margin-top: 8px;
      display: flex;
      justify-content: space-between;
    }

    .options label {
      margin-right: 15px;
      display: inline-block;
    }

    input[type="text"] {
      width: 100%;
      padding: 10px;
      margin-bottom: 20px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    #error-message {
      color: #e74c3c;
      font-weight: bold;
      display: none;
      margin-bottom: 15px;
    }

    button {
      padding: 10px 20px;
      font-size: 16px;
      margin-top: 20px;
      margin-right: 10px;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    button:hover {
      background-color: #2980b9;
    }

    #results {
      margin-top: 40px;
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 10px;
      background: #f9f9f9;
      display: none;
    }

    .result-section {
      margin-bottom: 20px;
    }

    .result-section span {
      font-weight: bold;
    }

    /* Estilos para el modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 999;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.4);
    }

    .modal-content {
      background-color: #fefefe;
      margin: 15% auto;
      padding: 20px;
      border-radius: 8px;
      width: 80%;
      max-width: 400px;
      text-align: center;
    }

    .modal-content button {
      margin-top: 15px;
      padding: 8px 16px;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .disc-traits {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .trait-card {
      width: 48%;
      margin-bottom: 15px;
      padding: 10px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .trait-card.D {
      border-left: 4px solid #e74c3c;
      background-color: #fdecea;
    }

    .trait-card.I {
      border-left: 4px solid #f39c12;
      background-color: #fef5e7;
    }

    .trait-card.S {
      border-left: 4px solid #2ecc71;
      background-color: #e8f8f0;
    }

    .trait-card.C {
      border-left: 4px solid #3498db;
      background-color: #ebf5fb;
    }

    .trait-title {
      font-weight: bold;
      margin-bottom: 5px;
    }

    .disc-graph {
      width: 100%;
      height: 200px;
      margin: 20px 0;
      display: flex;
      align-items: flex-end;
      justify-content: space-around;
    }

    .graph-bar {
      width: 20%;
      text-align: center;
    }

    .bar {
      width: 80%;
      margin: 0 auto;
      transition: height 0.5s ease;
    }

    .bar.D {
      background-color: #e74c3c;
    }

    .bar.I {
      background-color: #f39c12;
    }

    .bar.S {
      background-color: #2ecc71;
    }

    .bar.C {
      background-color: #3498db;
    }

    .bar-label {
      margin-top: 5px;
      font-weight: bold;
    }

    .profile-description {
      margin-top: 20px;
      padding: 15px;
      background-color: #f8f9fa;
      border-radius: 5px;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>Test DISC</h1>
    <p style="text-align:center; margin-top:-10px;">Evaluación de Rasgos de Personalidad</p>
    <div class="intro-box">
      <p>Los Rasgos de personalidad medidos por el Test DISC son:</p>
      <div class="disc-traits">
        <div class="trait-card D">
          <div class="trait-title">Dominancia (D)</div>
          <div>Seguridad en sí mismo | competitivo | individualista | desafiante | orientado a metas | crítico e impaciente con otros.</div>
        </div>
        <div class="trait-card I">
          <div class="trait-title">Influencia (I)</div>
          <div>Extrovertido | generalmente hábil socialmente | disfruta las reuniones y relacionarse con las personas | optimista.</div>
        </div>
        <div class="trait-card S">
          <div class="trait-title">Estabilidad (S)</div>
          <div>Paciente | Dispuesto a ayudar a otros | Puede lidiar con la rutina, el trabajo detallado | controlado | calmado.</div>
        </div>
        <div class="trait-card C">
          <div class="trait-title">Concienzudez (C)</div>
          <div>Adaptable | evita tomar riesgos | cuidadoso | diplomático | se atiene a reglas y regulaciones.</div>
        </div>
      </div>
      <p><strong>Instrucciones:</strong> Para cada grupo de 4 afirmaciones, seleccione la que MÁS se aplica a usted y la que MENOS se aplica.</p>
      <p><em>Recuerde no existen respuestas "correctas" o "incorrectas" - se le pide que elija las respuestas que MÁS LE GUSTAN y aquellas que MENOS LE GUSTAN.</em></p>
    </div>
    <form id="disc-form">
      <label for="participant-name"><strong>Nombre del participante:</strong></label>
      <input id="participant-name" name="participant-name" placeholder="Escribe tu nombre (primero y luego apellido)" required="" type="text" />
      <div id="questions-container"></div>
      <div id="error-message"></div>
      <button id="calculate-btn" type="button">Calcular Resultados</button>
      <button id="download-pdf" type="button">Descargar PDF</button>
      <button id="download-excel" type="button">Descargar Excel</button>
      <button id="reset-form-btn" type="button">Limpiar formulario</button>
    </form>

    <div id="results">
      <h2>Resultados de <span id="display-name"></span></h2>
      
      <div class="disc-graph" id="disc-graph">
        <!-- Las barras se generarán dinámicamente con JavaScript -->
      </div>
      
      <div class="result-section">
        <h3>Perfil DISC</h3>
        <div id="profile-description" class="profile-description"></div>
      </div>
      
      <div class="result-section">
        <h3>Detalle por Rasgo</h3>
        <div id="trait-details"></div>
      </div>
      
      <div class="result-section">
        <h3>Recomendaciones</h3>
        <div id="recommendations"></div>
      </div>
    </div>

    <!-- Modal de éxito -->
    <div id="success-modal" class="modal">
      <div class="modal-content">
        <p>✅ Resultado calculado exitosamente.</p>
        <button onclick="closeModal()">Cerrar</button>
      </div>
    </div>
  </div>
  
  <script>
    // Configuración de Supabase
    const { createClient } = supabase;
    const supabaseUrl = 'https://eijeaimjxaywhohceqfc.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVpamVhaW1qeGF5d2hvaGNlcWZjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUxODg5NzEsImV4cCI6MjA2MDc2NDk3MX0.zyknNW6-uI0UtKhWIMVR-7K1EU5u_EYtpfsr8wgx7Mk';
    const supabaseClient = createClient(supabaseUrl, supabaseKey);

    // Funciones de manejo del modal
    function openModal() {
      document.getElementById("success-modal").style.display = "block";
    }

    function closeModal() {
      document.getElementById("success-modal").style.display = "none";
    }

    // Función para resetear el formulario
    function resetForm() {
      document.getElementById("disc-form").reset();
      document.getElementById("results").style.display = "none";
      document.getElementById("error-message").style.display = "none";
      
      // Limpiar selecciones de preguntas
      const questions = document.querySelectorAll('.question');
      questions.forEach(q => {
        q.classList.remove("invalid");
        const moreInputs = q.querySelectorAll('input[name$="-more"]');
        const lessInputs = q.querySelectorAll('input[name$="-less"]');
        moreInputs.forEach(input => input.checked = false);
        lessInputs.forEach(input => input.checked = false);
      });
    }

    // Preguntas del test DISC (28 grupos de 4 afirmaciones cada uno)
    const discQuestions = [
      // Grupo 1
      [
        "Las personas me respetan.",
        "Tiendo a ser una persona amable.",
        "Acepto a la vida como viene.",
        "Las personas dicen que tengo una fuerte personalidad."
      ],
      // Grupo 2
      [
        "Encuentro difícil relajarme.",
        "Tengo un círculo muy amplio de amigos.",
        "Siempre estoy listo para ayudar a otros.",
        "Me gusta comportarme correctamente."
      ],
      // Grupo 3
      [
        "Tiendo a hacer lo que se me pide.",
        "Me gustan que las cosas estén limpias y ordenadas.",
        "Las personas no pueden rebajarme.",
        "Disfruto haciendo cosas divertidas."
      ],
      // Grupo 4
      [
        "Respeto a mis mayores y a aquellas personas en autoridad.",
        "Siempre estoy dispuesto a tomar riesgos.",
        "Creo que las cosas resultarán bien.",
        "Siempre estoy dispuesto a ayudar."
      ],
      // Grupo 5
      [
        "Soy una persona limpia y ordenada.",
        "Soy muy activo, tanto en el trabajo como en mis pasatiempos.",
        "Soy una persona tranquila y calmada.",
        "Generalmente hago las cosas a mi manera."
      ],
      // Grupo 6
      [
        "Estoy contento con la vida.",
        "Confío en las personas.",
        "Me gusta la tranquilidad y el silencio.",
        "Tengo una actitud muy positiva."
      ],
      // Grupo 7
      [
        "Tengo mucha fuerza de voluntad.",
        "Siempre pongo atención a lo que dicen los demás.",
        "Trato de ser servicial.",
        "Estoy siempre contento."
      ],
      // Grupo 8
      [
        "Soy seguro de mí mismo.",
        "Las personas dicen que soy una persona comprensiva.",
        "Tengo una actitud tolerante hacia la vida.",
        "Expreso mis opiniones con seguridad."
      ],
      // Grupo 9
      [
        "Nunca pierdo mi temperamento.",
        "Me gusta que las cosas sean precisas y correctas.",
        "Soy una persona muy segura de mí misma.",
        "Disfruto de las bromas y chistes."
      ],
      // Grupo 10
      [
        "Mi comportamiento es bien disciplinado.",
        "Las personas me ven como alguien amable.",
        "Estoy siempre en movimiento.",
        "Persevero hasta que consigo lo que quiero."
      ],
      // Grupo 11
      [
        "Disfruto competir.",
        "No me tomo la vida muy seriamente.",
        "Siempre considero a los demás.",
        "Soy una persona simpática."
      ],
      // Grupo 12
      [
        "Soy muy persuasivo.",
        "Me veo a mí mismo como una persona calmada.",
        "Tengo una actitud de modestia.",
        "Usualmente se me ocurren ideas originales."
      ],
      // Grupo 13
      [
        "Me gusta mucho ayudar a otros.",
        "No me gusta tentar al destino.",
        "No me rindo fácilmente.",
        "Las personas disfrutan mi compañía."
      ],
      // Grupo 14
      [
        "Tiendo a ser una persona precavida.",
        "Soy una persona muy decidida.",
        "Soy bueno convenciendo a los demás.",
        "Usualmente soy una persona amigable."
      ],
      // Grupo 15
      [
        "No me asusto fácilmente.",
        "Las personas encuentran mi compañía estimulante.",
        "Siempre estoy dispuesto a seguir órdenes.",
        "Soy más bien una persona tímida."
      ],
      // Grupo 16
      [
        "Siempre estoy dispuesto a cambiar mis opiniones.",
        "Disfruto de una buena discusión.",
        "Soy una persona fácil de llevar.",
        "Siempre miro el lado positivo de la vida."
      ],
      // Grupo 17
      [
        "Soy una persona muy sociable.",
        "Tengo bastante paciencia.",
        "Soy del tipo de personas auto-suficiente.",
        "Raramente alzo mi voz."
      ],
      // Grupo 18
      [
        "Siempre estoy listo y dispuesto.",
        "Siempre estoy ansioso de probar cosas nuevas.",
        "No me gustan las discusiones.",
        "Las personas me describen de espíritu alegre."
      ],
      // Grupo 19
      [
        "Disfruto asumiendo un riesgo.",
        "Soy muy receptivo con las ideas de los demás.",
        "Siempre soy cortés y educado.",
        "Soy más bien una persona moderada que extrema."
      ],
      // Grupo 20
      [
        "Soy un persona mas bien indulgente.",
        "Soy una persona sensible.",
        "Tengo mucha energía y vigor.",
        "Me puedo mezclar en cualquier ambiente."
      ],
      // Grupo 21
      [
        "Disfruto conversando con las personas.",
        "Controlo mis emociones.",
        "Soy muy convencional en mi apariencia.",
        "Tomo decisiones rápidamente."
      ],
      // Grupo 22
      [
        "Tiendo a guardar mis emociones para mí mismo.",
        "La precisión es muy importante para mí.",
        "Me gusta decir lo que se me viene a la cabeza.",
        "Soy muy amigable."
      ],
      // Grupo 23
      [
        "Me gusta manejar las cosas con diplomacia.",
        "Soy una persona muy osada.",
        "A la mayoría de la personas les caigo bien.",
        "Me siento satisfecho con la vida."
      ],
      // Grupo 24
      [
        "Soy una persona obediente.",
        "Siempre estoy dispuesto a intentarlo.",
        "Lealtad es una de mis fortalezas.",
        "Soy una persona atractiva para los demás."
      ],
      // Grupo 25
      [
        "Tiendo a ser del tipo de persona más bien agresiva.",
        "Me gusta divertirme y tengo mucha personalidad.",
        "Las personas me ven como alguien fácil de conmover.",
        "Soy más bien una persona tímida."
      ],
      // Grupo 26
      [
        "Soy bueno motivando a los demás.",
        "Paciencia es una de mis mayores fortalezas.",
        "Soy cuidadoso en decir la frase correcta.",
        "Tengo un fuerte deseo de ganar."
      ],
      // Grupo 27
      [
        "Soy una persona fácil de llevar.",
        "Me da bastante satisfacción ayudar a otros.",
        "Siempre pienso las cosas muy bien.",
        "Prefiero hacer las cosas ahora que después."
      ],
      // Grupo 28
      [
        "Soy bueno analizando situaciones.",
        "Me vuelvo inquieto fácilmente.",
        "Pienso cómo mis decisiones pueden afectar a otros.",
        "Las personas me ven como relajado y fácil de tratar."
      ]
    ];

    // Mapeo de preguntas a rasgos DISC (D, I, S, C)
    const questionTraits = [
      // Grupo 1
      ["D", "I", "S", "D"],
      // Grupo 2
      ["D", "I", "S", "C"],
      // Grupo 3
      ["S", "C", "D", "I"],
      // Grupo 4
      ["C", "D", "I", "S"],
      // Grupo 5
      ["C", "D", "S", "D"],
      // Grupo 6
      ["S", "I", "S", "I"],
      // Grupo 7
      ["D", "I", "S", "I"],
      // Grupo 8
      ["D", "I", "S", "D"],
      // Grupo 9
      ["S", "C", "D", "I"],
      // Grupo 10
      ["C", "I", "D", "D"],
      // Grupo 11
      ["D", "I", "S", "I"],
      // Grupo 12
      ["D", "S", "C", "I"],
      // Grupo 13
      ["S", "C", "D", "I"],
      // Grupo 14
      ["C", "D", "I", "I"],
      // Grupo 15
      ["D", "I", "S", "S"],
      // Grupo 16
      ["S", "D", "S", "I"],
      // Grupo 17
      ["I", "S", "D", "S"],
      // Grupo 18
      ["S", "D", "S", "I"],
      // Grupo 19
      ["D", "I", "C", "S"],
      // Grupo 20
      ["S", "I", "D", "I"],
      // Grupo 21
      ["I", "C", "C", "D"],
      // Grupo 22
      ["S", "C", "D", "I"],
      // Grupo 23
      ["C", "D", "I", "S"],
      // Grupo 24
      ["S", "D", "S", "I"],
      // Grupo 25
      ["D", "I", "S", "S"],
      // Grupo 26
      ["I", "S", "C", "D"],
      // Grupo 27
      ["S", "I", "C", "D"],
      // Grupo 28
      ["C", "D", "S", "S"]
    ];

    // Generar las preguntas en el formulario
    const container = document.getElementById("questions-container");
    discQuestions.forEach((group, groupIndex) => {
      const groupDiv = document.createElement("div");
      groupDiv.className = "question-group";
      groupDiv.innerHTML = `<h3>Grupo ${groupIndex + 1}</h3><p>Seleccione la afirmación que MÁS y MENOS se aplica a usted:</p>`;
      
      group.forEach((question, questionIndex) => {
        const questionDiv = document.createElement("div");
        questionDiv.className = "question";
        questionDiv.id = `question-${groupIndex+1}-${questionIndex+1}`;
        questionDiv.innerHTML = `
          <div>
            <label>
              <input type="radio" name="group-${groupIndex+1}-more" value="${questionTraits[groupIndex][questionIndex]}" data-question="${questionIndex}">
              MÁS me aplica
            </label>
            <label>
              <input type="radio" name="group-${groupIndex+1}-less" value="${questionTraits[groupIndex][questionIndex]}" data-question="${questionIndex}">
              MENOS me aplica
            </label>
          </div>
          <p>${question}</p>
        `;
        groupDiv.appendChild(questionDiv);
      });
      
      container.appendChild(groupDiv);
    });

    // Función para calcular los resultados
    document.getElementById("calculate-btn").addEventListener("click", () => {
      const name = document.getElementById("participant-name").value.trim();
      const errorMsg = document.getElementById("error-message");
      const results = { D: 0, I: 0, S: 0, C: 0 };
      let incompleteGroups = [];
      
      // Verificar que se hayan respondido todos los grupos
      for (let i = 1; i <= 28; i++) {
        const moreSelected = document.querySelector(`input[name="group-${i}-more"]:checked`);
        const lessSelected = document.querySelector(`input[name="group-${i}-less"]:checked`);
        
        if (!moreSelected || !lessSelected) {
          incompleteGroups.push(i);
          // Resaltar grupo incompleto
          const groupDivs = document.querySelectorAll(`[id^="question-${i}-"]`);
          groupDivs.forEach(div => div.classList.add("invalid"));
        } else {
          // Quitar resaltado si estaba marcado como inválido
          const groupDivs = document.querySelectorAll(`[id^="question-${i}-"]`);
          groupDivs.forEach(div => div.classList.remove("invalid"));
          
          // Sumar puntos para MÁS seleccionado
          results[moreSelected.value]++;
          
          // Restar puntos para MENOS seleccionado
          results[lessSelected.value]--;
        }
      }
      
      if (!name || incompleteGroups.length > 0) {
        errorMsg.textContent = !name ? "Ingrese su nombre." : `Faltan selecciones en los grupos: ${incompleteGroups.join(', ')}`;
        errorMsg.style.display = "block";
        return;
      }
      errorMsg.style.display = "none";
      
      // Normalizar resultados (asegurar que no sean negativos)
      const minScore = Math.min(...Object.values(results));
      if (minScore < 0) {
        for (const trait in results) {
          results[trait] += Math.abs(minScore);
        }
      }
      
      // Mostrar resultados
      document.getElementById("display-name").textContent = name;
      displayResults(results);
      document.getElementById("results").style.display = "block";
      
      // Guardar en Supabase
      supabaseClient
        .from('resultados_disc')
        .insert([{
          nombre: name,
          dominio: results.D,
          influencia: results.I,
          estabilidad: results.S,
          concienzudez: results.C,
          perfil: getProfileType(results)
        }])
        .then(response => {
          if (response.error) {
            console.error('Error al guardar en Supabase:', response.error);
          } else {
            console.log('Resultado guardado en Supabase.');
            openModal();
          }
        });
    });

    // Función para determinar el tipo de perfil basado en los resultados
    function getProfileType(results) {
      const maxTrait = Object.keys(results).reduce((a, b) => results[a] > results[b] ? a : b);
      
      const profiles = {
        'D': 'Dominante - Orientado a resultados, decisivo, directo',
        'I': 'Influyente - Sociable, comunicativo, optimista',
        'S': 'Estable - Paciente, predecible, buen oyente',
        'C': 'Concienzudo - Analítico, preciso, sistemático'
      };
      
      return profiles[maxTrait];
    }

    // Función para mostrar los resultados
    function displayResults(results) {
      const total = Object.values(results).reduce((a, b) => a + b, 0);
      const percentages = {
        D: Math.round((results.D / total) * 100),
        I: Math.round((results.I / total) * 100),
        S: Math.round((results.S / total) * 100),
        C: Math.round((results.C / total) * 100)
      };
      
      // Generar gráfico
      const graphDiv = document.getElementById("disc-graph");
      graphDiv.innerHTML = '';
      
      for (const trait in percentages) {
        const barDiv = document.createElement("div");
        barDiv.className = "graph-bar";
        barDiv.innerHTML = `
          <div class="bar ${trait}" style="height: ${percentages[trait]}%"></div>
          <div class="bar-label">${trait} (${percentages[trait]}%)</div>
        `;
        graphDiv.appendChild(barDiv);
      }
      
      // Descripción del perfil
      const profileType = getProfileType(results);
      const profileDesc = document.getElementById("profile-description");
      
      let description = '';
      if (results.D > results.I && results.D > results.S && results.D > results.C) {
        description = `
          <p><strong>Perfil Dominante (D):</strong></p>
          <p>Disfruta los retos y la competición. Es orientado a metas y quiere ser reconocido por sus esfuerzos. 
          Tiene variados recursos, apunta alto y quiere autoridad. Es auto-suficiente e individualista. 
          Tiende a ser directo y categórico con las personas.</p>
        `;
      } else if (results.I > results.D && results.I > results.S && results.I > results.C) {
        description = `
          <p><strong>Perfil Influyente (I):</strong></p>
          <p>Extrovertido, generalmente hábil socialmente, disfruta las reuniones y relacionarse con las personas. 
          Optimista y entusiasta. Le gusta ser el centro de atención y tiene facilidad para motivar a otros.</p>
        `;
      } else if (results.S > results.D && results.S > results.I && results.S > results.C) {
        description = `
          <p><strong>Perfil Estable (S):</strong></p>
          <p>Paciente, dispuesto a ayudar a otros, puede lidiar con la rutina y el trabajo detallado. 
          Controlado y calmado. Prefiere ambientes estables y predecibles, es un buen oyente y leal.</p>
        `;
      } else {
        description = `
          <p><strong>Perfil Concienzudo (C):</strong></p>
          <p>Adaptable, evita tomar riesgos, cuidadoso, diplomático, se atiene a reglas y regulaciones. 
          Analítico, preciso y sistemático. Valora la calidad y la exactitud en su trabajo.</p>
        `;
      }
      
      profileDesc.innerHTML = description;
      
      // Detalle por rasgo
      const traitDetails = document.getElementById("trait-details");
      traitDetails.innerHTML = `
        <div class="trait-card D">
          <div class="trait-title">Dominancia (D): ${results.D} puntos</div>
          <div>${getTraitDescription('D', results.D)}</div>
        </div>
        <div class="trait-card I">
          <div class="trait-title">Influencia (I): ${results.I} puntos</div>
          <div>${getTraitDescription('I', results.I)}</div>
        </div>
        <div class="trait-card S">
          <div class="trait-title">Estabilidad (S): ${results.S} puntos</div>
          <div>${getTraitDescription('S', results.S)}</div>
        </div>
        <div class="trait-card C">
          <div class="trait-title">Concienzudez (C): ${results.C} puntos</div>
          <div>${getTraitDescription('C', results.C)}</div>
        </div>
      `;
      
      // Recomendaciones
      const recommendations = document.getElementById("recommendations");
      recommendations.innerHTML = `
        <p><strong>Recomendaciones basadas en su perfil:</strong></p>
        <ul>
          ${getRecommendations(results).map(rec => `<li>${rec}</li>`).join('')}
        </ul>
      `;
    }
    
    // Función para obtener descripción detallada de cada rasgo
    function getTraitDescription(trait, score) {
      const descriptions = {
        'D': [
          'Bajo: Evita confrontaciones, prefiere no destacar',
          'Moderado: Asertivo cuando es necesario pero no agresivo',
          'Alto: Muy orientado a resultados, directo y competitivo'
        ],
        'I': [
          'Bajo: Reservado, prefiere no ser el centro de atención',
          'Moderado: Sociable pero no abrumadoramente extrovertido',
          'Alto: Muy comunicativo, entusiasta y persuasivo'
        ],
        'S': [
          'Bajo: Le gusta el cambio y la variedad, impaciente con la rutina',
          'Moderado: Equilibrado entre flexibilidad y estabilidad',
          'Alto: Muy paciente, consistente y buen oyente'
        ],
        'C': [
          'Bajo: Flexible con las reglas, toma riesgos calculados',
          'Moderado: Organizado pero no perfeccionista',
          'Alto: Muy analítico, preciso y atento a los detalles'
        ]
      };
      
      if (score <= 5) return descriptions[trait][0];
      if (score <= 10) return descriptions[trait][1];
      return descriptions[trait][2];
    }
    
    // Función para generar recomendaciones basadas en el perfil
    function getRecommendations(results) {
      const maxTrait = Object.keys(results).reduce((a, b) => results[a] > results[b] ? a : b);
      const recommendations = [];
      
      if (maxTrait === 'D') {
        recommendations.push(
          "Aproveche su capacidad de liderazgo en roles que requieran toma de decisiones rápidas.",
          "Trabaje en desarrollar más paciencia y empatía con los demás.",
          "Busque proyectos desafiantes donde pueda demostrar su iniciativa."
        );
      } else if (maxTrait === 'I') {
        recommendations.push(
          "Utilice sus habilidades sociales en roles que requieran networking o ventas.",
          "Trabaje en desarrollar más atención a los detalles y seguimiento.",
          "Busque entornos dinámicos donde pueda interactuar con muchas personas."
        );
      } else if (maxTrait === 'S') {
        recommendations.push(
          "Aproveche su estabilidad en roles que requieran consistencia y confiabilidad.",
          "Trabaje en ser más asertivo cuando necesite expresar sus opiniones.",
          "Busque entornos con procesos establecidos donde pueda prosperar."
        );
      } else {
        recommendations.push(
          "Aproveche su atención al detalle en roles que requieran precisión y análisis.",
          "Trabaje en ser más flexible cuando las circunstancias lo requieran.",
          "Busque proyectos donde pueda aplicar su pensamiento lógico y sistemático."
        );
      }
      
      // Recomendación general basada en el rasgo más bajo
      const minTrait = Object.keys(results).reduce((a, b) => results[a] < results[b] ? a : b);
      if (minTrait === 'D') {
        recommendations.push("Considere desarrollar más asertividad y capacidad de toma de decisiones rápidas.");
      } else if (minTrait === 'I') {
        recommendations.push("Considere trabajar en sus habilidades sociales y de comunicación.");
      } else if (minTrait === 'S') {
        recommendations.push("Considere desarrollar más paciencia y tolerancia a la rutina.");
      } else {
        recommendations.push("Considere trabajar en su atención a los detalles y precisión.");
      }
      
      return recommendations;
    }

    // Evento para el botón de descargar PDF
    document.getElementById("download-pdf").addEventListener("click", () => {
      const doc = new window.jspdf.jsPDF();
      doc.text("Resultados Test DISC", 20, 20);
      doc.text(`Nombre: ${document.getElementById("participant-name").value}`, 20, 30);
      
      // Agregar gráfico (simplificado)
      doc.setFillColor(231, 76, 60);
      doc.rect(20, 50, 40, 100, 'F'); // D
      doc.setFillColor(243, 156, 18);
      doc.rect(70, 50, 40, 80, 'F');  // I
      doc.setFillColor(46, 204, 113);
      doc.rect(120, 50, 40, 70, 'F'); // S
      doc.setFillColor(52, 152, 219);
      doc.rect(170, 50, 40, 60, 'F'); // C
      
      doc.text("D", 40, 155);
      doc.text("I", 90, 155);
      doc.text("S", 140, 155);
      doc.text("C", 190, 155);
      
      // Agregar descripción del perfil
      const profileDesc = document.getElementById("profile-description").textContent;
      doc.text("Perfil:", 20, 170);
      doc.text(profileDesc, 20, 180, { maxWidth: 170 });
      
      doc.save("Resultados_DISC.pdf");
    });

    // Evento para el botón de descargar Excel
    document.getElementById("download-excel").addEventListener("click", () => {
      const wb = XLSX.utils.book_new();
      const ws = XLSX.utils.aoa_to_sheet([
        ["Nombre", document.getElementById("participant-name").value],
        ["Rasgo", "Puntuación", "Descripción"],
        ["Dominancia (D)", results.D, getTraitDescription('D', results.D)],
        ["Influencia (I)", results.I, getTraitDescription('I', results.I)],
        ["Estabilidad (S)", results.S, getTraitDescription('S', results.S)],
        ["Concienzudez (C)", results.C, getTraitDescription('C', results.C)],
        ["Perfil", "", getProfileType(results)]
      ]);
      XLSX.utils.book_append_sheet(wb, ws, "Resultados");
      XLSX.writeFile(wb, "Resultados_DISC.xlsx");
    });

    // Evento para el botón de resetear formulario
    document.getElementById("reset-form-btn").addEventListener("click", resetForm);
  </script>
</body>

</html>